---
layout: posts
title: synology nas 활용 가이드
tags: [nas, synology, cloud, plex, dsm]
categories: IT
---

최근에 synology nas를 구입하면서 이것저것 만져보다가 알게 된 내용들을 한번 정리했다. 기기를 사면 꼼꼼히 살피거나 하는 성격은 아니지만 배운다는 생각으로 신경써서 해봤다. 나름 생각보다 재밌었던 이유가 만지면서 컴퓨터 관련 내용들을 어느정도 배울 수 있었다. 처음에는 완제품을 다루는 거라 그런 것을 기대하지는 않았지만 내 수준에서는 충분히 도움 됐다고 본다. 앞으로 새로운 앱이나 기기가 나왔을 때 도전적으로 시도해보고 싶다는 생각도 들었다.

사용하는 NAS info는 다음과 같다.

* Synology DS920+
* DSM version 7.0.1-42218
* 씨게이트 아이언울프 4TB  4ea

### NAS (Network-attached storage)
Network-attached storage의 약자로 말 그대로 네트워크에 연결된 저장 장치를 뜻한다. NAS는 다른 저장 장치와 달리 네트워크를 통해 데이터를 주고 받는다는 것이 기본적으로 다르다. 그렇기에 인터넷에 접속되어 있다면 언제 어디서든 NAS에 접속해 데이터를 만질 수 있다. 또한 NAS는 하나의 독립적인 컴퓨터로서 데이터 관리 외에도 다양한 기능을 수행할 수 있다. 반면에 일반적으로 우리가 접하는 저장장치는 PC 내에 하드디스크 혹은 외부 저장장치인 USB나 외장하드, 카메라나 스마트폰에 많이 쓰이는 sanDisk 등이 있다. 이것들은 USB 포트나 연결선을 통해서 데이터를 주고 받지만 NAS는 네트워크를 이용하며 데이터 주고 받는 것 외에 다른 기능들도 있다.

대표적으로 많이 쓰이는 기능으로는 스트리밍 서버로서 활용하거나 토렌트를 통해 데이터를 받을 수 있다. 영상이나 음악 파일을 많이 가지고 있다면 N넷플릭스나 멜론 서비스처럼 영상이나 음악을 스트리밍에서 서비스를 구현해볼 수 있다. 시놀리지와 같이 개인 용도인 NAS 제품에는 이런 서비스를 쉽게 구축해주는 어플리케이션이 많이 나와 있다. 대표적으로 PLEX라는 앱이 있다.

### DSM (DiskStation Manager)
DSM는 synology 회사의 nas 제품에 들어 있는 운영체제이다. Web-based라서 원격 접속할 때 터미널이 아닌 웹 브라우져를 이용하여 접속한다. 개인적으로 이용할 때 군더더기 없고 딱 필요한 것들만 있다는 느낌이 들어서 좋았다. 2022년 1월 기준 현재 버전은 7.0까지 나와 있다. 버전 6에서 버전 7로 옮기면서 큰 변화가 일어났다. 사용자 권한과 공유폴더 권한 부여 방식이 바뀐 듯 하다.

### 하드디스크
하드디스크에도 여러 종류가 있다는 것을 알았다. NAS에 적합한 하드디스크가 씨게이트 아이언울프 제품이라는 소리를 듣고 구매했다. 아이언울프 프로도 있는데 알아보니 성능이 약간 좋다고는 하는데 비슷하다는 게 더 알맞은 말 같다. 다른 것은 보장기간이 프로가 2년이 더 긴데 하드디스크에 보증기간이 의미가 있나 싶다. 하드디스크 고장나는 걸 본 적이 없다. 그래서 프로가 아닌 아이언울프로 구매했다.

### 레이드 구성
레이드는 Redundant Array of Independent Disk로 저장 장치 관련 병렬 처리 용어이다. 이전에는 성능 및 안정성을 향상 시키는 용도였지만 하드 성능이 많이 향상된 지금은 장애와 손실 방지책으로 쓰이고 있다. 레이드의 종류가 여러가지가 있다.

 - 레이드 0: 한 개가 아닌 여러 디스크에 나눠 저장. 성능은 뛰어나지만 장애에 취약하다.
 - 레이드 1: 여러 디스크에 같은 데이터 복제해서 저장. 성능은 느리지만 안정성은 뛰어나다.
 - 래이드 3,4: 레이드 0과 동일하지만 에러 체크를 위한 parity 정보가 있다. 레이드3는 byte단위로 저장하고 레이드4는 block단위로 저장한다.
 - 레이드 5: parity 정보 없이 다른 로직(?)으로 에러 체크하는 방식이다. 성능, 안정성 둘 다 고려되어 많이 사용하고 있는 방식이다.

 - SHR: Synology에서 개발한 레이드 방식이다. NAS에 최적화 되어 있다.

### 네트워크 공유폴더
네트워크 공유폴더로 NAS를 등록하면 윈도우나 맥OS 파일 시스템에서 쉽게 이용할 수 있다. DSM이 web-based이기 때문에 NAS에 있는 파일에 접근하려면 매번 웹 브라우저로 접속해야 하는 불편함이 있어 네트워크 공유폴더를 사용하는 걸 추천한다. 다양한 네트워크 프로토콜을 통해 NAS에 접속할 수 있다.

- SMB: 윈도우에서 쓰는 프로토콜인데, 최근에는 맥OS에서도 지원한다.
- AFP: 맥에서 쓰는 프로토콜로 내부, 외부 네트워크 접속이 모두 가능하다.

이 두가지는 일반적으로 내부 네트워크에 접속할 때 사용한다. 네트워크 공유폴더 등록해서 사용하면 된다.

맥OS: cmd + K > DSM 제어판에 나타난 주소 입력
window: 파일탐색기에서 주소 입력

- NFS: ???
- FTP: 파일 전송을 위한 프로토콜이다.

안 써봤다. 여기서는 https와 ftp 중 어떤 것이 빠른지 궁금해졌다.

- WebDAV: http와 https 프로토콜 기반이다. 윈도우와 맥OS 모두 지원한다.

포트포워딩을 해줘야 되서 이것저것 건드려줘야 된다. 아래 순서로 진행했다.

1) NAS webDAV 패키지 설치

NAS DSM 접속 > 패키지 센터 > ```WebDAV server``` 검색 후 설치 

2) https 포트 5006번 개방

NAS DSM 접속 좌측 상단 앱 패널 열기 > "WebDAV server" 패키지 열기 > https 활성화 박스 체크

3) DDNS 도메인 등록

제어판 > 외부 액세스 > DDNS 탭 > 추가 > 서비스 공급자: synology 선택 후 호스트 이름 작성 후 등록

4) 공유기 포트포워딩(iptime 기준)

웹 브라우저 https://192.168.0.1/ 접속 > 관리 > NAT/라우터 설정 > 포트포워딩 관리 > https, ip는 nas 게이트 주소 포트는 5006번 등록하기

5) PC에서 네트워크 공유폴드 등록 (macOS 기준)

맥os 파인더 > cmd+K > "https://yourDDNSname.synology.me:5006/" 연결

### https와 sftp 중 어떤 것이 빠를까?

답만 말하면 큰 차이 없다고 한다. 그럼 뭐가 다른 거지 하면 일단 보안을 위한 프로토콜은 다르다.

[https vs sftp](https://enterprisedt.com/blogs/completeftp/https-sftp-best/)

>So what protocol should be chosen - HTTPS or SFTP? If your scenario is lots of naive users who need to download only, HTTPS is probably best. But if more sophisticated file transfer is required, use SFTP. For larger file transfers (especially uploads) we recommend SFTP.

### Plex

Plex는 스트리밍 서버이다. 나만의 넷플릭스를 만들 수 있다. Plex 설치할 때 제일 고생 많이 했는데 DSM 6.0에서 7.0으로 바뀌면서 설정하는 게 헷갈렸다. 인터넷에 설명글은 6.0 기준으로 plex 설치법이 나와 있는데 필자는 7.0이라 설명하고 맞지 않아 고생했다.

1) Server 설치

nas에서 ```plex media server``` 검색 후 설치

2) 로컬에서 plex 서버 계정과 연동 후 외부로 개방

ip 번호는 nas 위치로 https:/192.168.XXX.XXX/web 으로 접속  후 외부로 개방 (개방 전에 외부에서 접속 시 "널 위한 스푸는 없다" 라는 어이 없는 에러 문구가 보인다.)

3) 공유기 포트포워딩

공유기에서 nas 주소로 32400 개방. 규칙은 포트포워드 사용자 정의와 TCP

4) 라이브러리 폴더 생성 및 등록

DDNS-주소.synology.me:32400/web으로 접속 > 로그인 > 상단 바 스패너 아이콘(설정) > 관리:라이브러리 > 라이브러리 추가

라이브러리를 추가하고 스캔해도 영상이 업로드가 안 된다. 그 이유는 권한 문제 때문이다.

5) plex 서버 권한 인계

DSM 제어판 > 공유폴더 > 라이브러리로 쓸 폴더 선택 > 편집 > 권한 > 로컬 사용자를 시스템 내부 사용자로 변경 > PlexMediaServer에게 읽기/쓰기 권한 부여

### 클라우드 연동

```cloud sync``` 패키지를 설치하면 드랍박스와 구글 드라이브와 동기화를 수행할 수 있다. 파일 전송은 양방향 모두 가능하고 싱크까지 맞출 수 있다. 참 편리하다.

### 토렌트

```Download Station``` 패키지 설치하면 토렌트를 nas 서버를 이용해 받을 수 있다.

### 아이폰, 아이패드 연동

파일 앱에서 smb 지원하기에 로컬로 연결 가능. nplayer에서 webDAV 지원. Plex가 있기 때문에 굳이 필요한가 싶다.

ftp 프로그램 받아서 토렌트 보내서 실시간으로 다운 받으면 ftp로 스트리밍하는 예도 봤다.
